# クラス仕様書: `CreateRagFineTuningData`

## クラス概要
`CreateRagFineTuningData` クラスは、テキストファイルからRAG (Retrieval-Augmented Generation) およびファインチューニング用のデータを生成します。クラスはPythonコードブロックとそれに関連する段落を解析し、サブタイトルおよび質問文を生成します。

## クラス詳細

| 項目               | 詳細                                                                                               |
|--------------------|----------------------------------------------------------------------------------------------------|
| **クラス名**       | `CreateRagFineTuningData`                                                                           |
| **モジュール**     | `0_create_rag_finetuning_data.py`                                                                   |
| **利用ライブラリ** | `re`, `glob`, `pathlib`, `json`, `pprint`, `openai.OpenAI`                                          |
| **概要**           | テキストファイルを処理し、RAGおよびファインチューニング用のデータを生成、保存するクラス。                                                |

## 初期化メソッド (`__init__`)

### IPO (Input, Process, Output)

| 項目              | 詳細                                                                                               |
|-------------------|----------------------------------------------------------------------------------------------------|
| **Input (入力)**  | なし                                                                                               |
| **Process (処理)**| クラスインスタンスの初期化処理を行う。<br>- 空の辞書 `python_code_to_dict` と `paragraph_to_dict` を初期化。<br>- カウンター `py_no` を1に設定。 |
| **Output (出力)** | なし                                                                                               |

## メソッド仕様書

### 1. `list_txt_files`

### IPO (Input, Process, Output)

| 項目              | 詳細                                                                                               |
|-------------------|----------------------------------------------------------------------------------------------------|
| **Input (入力)**  | なし                                                                                               |
| **Process (処理)**| 指定されたディレクトリ (`./document/`) 内の `.txt` ファイルを検索し、ファイルのパスをリスト化する。 |
| **Output (出力)** | `List[str]`: `.txt` ファイルのパスのリストを返す。                                                  |

### 2. `generate_subtitle`

### IPO (Input, Process, Output)

| 項目              | 詳細                                                                                               |
|-------------------|----------------------------------------------------------------------------------------------------|
| **Input (入力)**  | - `code_block` (str): Pythonコードが含まれる文字列。<br> - `title` (str): コードに関連するタイトル。 |
| **Process (処理)**| 1. `code_block` と `title` を基に、サブタイトル生成のためのプロンプト文字列を生成。<br>2. `OpenAI` クライアントを使ってプロンプトをAPIに送信。<br>    - モデル: `"gpt-4o-mini"`<br>    - 最大トークン数: 50<br>    - 温度 (temperature): 0.5<br>3. APIからのレスポンスを受け取り、`choices[0].message.content` からサブタイトルを抽出。<br>4. 不要な文字列（`"** "`）を除去して最終的なサブタイトルを得る。 |
| **Output (出力)** | `str`: コードブロックの機能を説明するサブタイトルを返す。                                             |

### 3. `generate_question`

### IPO (Input, Process, Output)

| 項目              | 詳細                                                                                               |
|-------------------|----------------------------------------------------------------------------------------------------|
| **Input (入力)**  | - `paragraph` (str): 説明文が含まれる段落。<br> - `title` (str): 段落に関連するタイトル。           |
| **Process (処理)**| 1. `paragraph` と `title` を基に、質問文生成のためのプロンプト文字列を生成。<br>2. `OpenAI` クライアントを使ってプロンプトをAPIに送信。<br>    - モデル: `"gpt-4o-mini"`<br>    - 最大トークン数: 50<br>    - 温度 (temperature): 0.5<br>3. APIからのレスポンスを受け取り、`choices[0].message.content` から質問文を抽出。 |
| **Output (出力)** | `str`: 段落の内容に基づいた質問文を返す。                                                             |

### 4. `split_into_paragraphs`

### IPO (Input, Process, Output)

| 項目              | 詳細                                                                                               |
|-------------------|----------------------------------------------------------------------------------------------------|
| **Input (入力)**  | - `file_path` (str): 処理するテキストファイルのパス。                                               |
| **Process (処理)**| 1. テキストファイルを読み込み、Pythonコードブロックとそれ以外の段落に分割。<br>2. Pythonコードブロックを抽出し、それ以外の部分を段落に分割。 |
| **Output (出力)** | `Tuple[List[str], List[str]]`: 段落のリストとPythonコードブロックのリストを返す。                    |

### 5. `process_files`

### IPO (Input, Process, Output)

| 項目              | 詳細                                                                                               |
|-------------------|----------------------------------------------------------------------------------------------------|
| **Input (入力)**  | なし                                                                                               |
| **Process (処理)**| 1. テキストファイルをリスト化し、各ファイルを処理。<br>2. 各ファイル内のPythonコードブロックと段落からサブタイトルと質問文を生成。<br>3. 生成されたデータを辞書に保存。 |
| **Output (出力)** | なし                                                                                               |

### 6. `save_to_json`

### IPO (Input, Process, Output)

| 項目              | 詳細                                                                                               |
|-------------------|----------------------------------------------------------------------------------------------------|
| **Input (入力)**  | なし                                                                                               |
| **Process (処理)**| 生成された辞書データをJSONファイルに保存。                                                          |
| **Output (出力)** | なし                                                                                               |


### 関数仕様書: `generate_subtitle`

| 項目              | 詳細                                                                                               |
|-------------------|----------------------------------------------------------------------------------------------------|
| **関数名**        | `generate_subtitle`                                                                                 |
| **クラス名**      | `CreateRagFineTuningData`                                                                           |
| **利用ライブラリ**| `openai.OpenAI`                                                                                     |
| **概要**          | コードブロックとそのタイトルを入力として受け取り、コードの機能を詳細に説明するサブタイトルを生成する。生成されたサブタイトルはOpenAIのAPIを使用し、最大80文字に制限される。 |

#### IPO (Input, Process, Output)

| 項目              | 詳細                                                                                               |
|-------------------|----------------------------------------------------------------------------------------------------|
| **Input (入力)**  | - `code_block` (str): Pythonコードが含まれる文字列。<br>例: `def example_function(): pass` <br> - `title` (str): コードに関連するタイトル。<br>例: `"Example Function"` |
| **Process (処理)**| 1. `code_block` と `title` を基に、サブタイトル生成のためのプロンプト文字列を生成。<br>2. `OpenAI` クライアントを使ってプロンプトをAPIに送信。<br>    - モデル: `"gpt-4o-mini"`<br>    - 最大トークン数: 50<br>    - 温度 (temperature): 0.5<br>3. APIからのレスポンスを受け取り、`choices[0].message.content` からサブタイトルを抽出。<br>4. 不要な文字列（`"** "`）を除去して最終的なサブタイトルを得る。 |
| **Output (出力)** | - `subtitle` (str): コードブロックの機能を説明するサブタイトル。<br>例: `"This function serves as an example and does not perform any operations."` |

---

### 関数仕様書: `generate_question`

| 項目              | 詳細                                                                                               |
|-------------------|----------------------------------------------------------------------------------------------------|
| **関数名**        | `generate_question`                                                                                 |
| **クラス名**      | `CreateRagFineTuningData`                                                                           |
| **利用ライブラリ**| `openai.OpenAI`                                                                                     |
| **概要**          | 段落とそのタイトルを入力として受け取り、その段落に基づいた質問文を生成する。この質問文はOpenAIのAPIを使用して生成され、80文字以内に制限される。 |

#### IPO (Input, Process, Output)

| 項目              | 詳細                                                                                               |
|-------------------|----------------------------------------------------------------------------------------------------|
| **Input (入力)**  | - `paragraph` (str): 説明文が含まれる段落。<br>例: `"This function is used to demonstrate basic syntax in Python."`<br> - `title` (str): 段落に関連するタイトル。<br>例: `"Python Syntax Example"` |
| **Process (処理)**| 1. `paragraph` と `title` を基に、質問文生成のためのプロンプト文字列を生成。<br>2. `OpenAI` クライアントを使ってプロンプトをAPIに送信。<br>    - モデル: `"gpt-4o-mini"`<br>    - 最大トークン数: 50<br>    - 温度 (temperature): 0.5<br>3. APIからのレスポンスを受け取り、`choices[0].message.content` から質問文を抽出。 |
| **Output (出力)** | - `question` (str): 段落の内容に基づいた質問文。<br>例: `"What does the example function demonstrate in terms of Python syntax?"` |
